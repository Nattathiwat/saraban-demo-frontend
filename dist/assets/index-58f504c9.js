import{_ as I,r as u,o as C,c as P,w as b,v as N,a as e,t as F,b as r,d as R,e as V,f as q,n as k,g as L}from"./index-6f9b4dc9.js";const A="/assets/pkm_logo-94349e4f.png";const M={name:"login-index",data(){return{modalRepass:!1,focusPersonNo:!1,focusPassword:!1,data:{personNo:"",password:"",message:"ชื่อผู้ใช้ หรือ รหัสผ่าน ไม่ถูกต้อง !",fname:"",lname:""},modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,loginFalse:!1}},methods:{nameClick(){this.focusPersonNo=!0,document.querySelector('[name="personNoInput"]').focus()},passClick(){this.focusPassword=!0,document.querySelector('[name="passwordInput"]').focus()},closeModalRepass(){this.modalRepass=!1},repasswordClick(){this.modalRepass=!0},onSubmit(c){let s={};s={username:this.data.personNo,password:this.data.password},this.showLoading=!0,this.axios.post("/auth/login",s,{headers:{"Content-Type":"application/json"}}).then(l=>{const p=this.axios.get(`/department/${l.data.data.department_id}`),a=this.axios.get(`/user/${l.data.data.user_id}`);this.axios.all([p,a]).then(this.axios.spread((...o)=>{var m,t,g,f,v,w,_,h,x,S;this.showLoading=!1;const n=o[0],d=o[1];localStorage.setItem("profile_img",((m=d.data.data)==null?void 0:m.profile_img)||""),localStorage.setItem("filename",((t=n.data.data)==null?void 0:t.filename)||""),localStorage.setItem("filename",((g=n.data.data)==null?void 0:g.filename)||""),localStorage.setItem("filepath",((f=n.data.data)==null?void 0:f.filepath)||""),localStorage.setItem("user_id",((v=l.data.data)==null?void 0:v.user_id)||""),localStorage.setItem("department_name",((w=l.data.data)==null?void 0:w.department)||""),localStorage.setItem("department_id",((_=l.data.data)==null?void 0:_.department_id)||""),localStorage.setItem("fname",((h=l.data.data)==null?void 0:h.fname)||""),localStorage.setItem("lname",((x=l.data.data)==null?void 0:x.lname)||""),localStorage.setItem("login","true"),localStorage.setItem("data_rule",JSON.stringify(d.data.data.roles)),localStorage.setItem("subministry_id",((S=d.data.data)==null?void 0:S.subministry_id)||"");let i={};d.data.data.roles.filter(y=>{i[`user${y.role_id}`]=!0}),this.ruleSet(i),i!=null&&i.user1||i!=null&&i.user3?this.$router.push({name:"my-work.waiting-booking-receive"}).catch(()=>{}):this.$router.push({name:"subministry-work.booking-receive"}).catch(()=>{})})).catch(o=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:o.response.data.message}})}).catch(l=>{this.showLoading=!1,this.data.message=l.response.data.message,this.loginFalse=!0,this.data.personNo="",this.data.password=""})}},created(){localStorage.setItem("login","false")},watch:{modalRepass(){document.body.style.overflow=this.modalRepass?"hidden":""}}},E={class:"login-index"},z={class:"card-center"},B={class:"group-input"},D={class:"group-input"},U={class:"modal-class-repass"},j={class:"modal-center"},J={class:"modal-size"},O={class:"group-footer center"};function T(c,s,l,p,a,o){const n=u("cpn-input"),d=u("Form"),i=u("cpn-modal-alert"),m=u("cpn-loading");return C(),P("div",E,[b(e("div",{class:"login-false"},F(a.data.message)+" !",513),[[N,a.loginFalse]]),e("div",z,[s[12]||(s[12]=e("div",{class:"group-image"},[e("img",{class:"image-logo",src:A,alt:"logo"}),e("div",{class:"title"},"ระบบสารบรรณอิเล็กทรอนิกส์")],-1)),r(d,{onSubmit:s[9]||(s[9]=t=>o.onSubmit(!1)),onInvalidSubmit:c.onInvalidSubmit},{default:R(()=>[e("div",B,[e("div",{class:k(["input-name",!a.data.personNo&&!a.focusPersonNo?"show-text":""]),onClick:s[0]||(s[0]=(...t)=>o.nameClick&&o.nameClick(...t))},"ชื่อผู้ใช้งาน หรือ Email",2),r(n,{modelValue:a.data.personNo,"onUpdate:modelValue":s[1]||(s[1]=t=>a.data.personNo=t),name:"personNo",type:"text",classN:"input-login",rules:"required",onFocusin:s[2]||(s[2]=t=>a.focusPersonNo=!0),onFocusout:s[3]||(s[3]=t=>a.focusPersonNo=!1)},null,8,["modelValue"])]),e("div",D,[e("div",{class:k(["input-name",!a.data.password&&!a.focusPassword?"show-text":""]),onClick:s[4]||(s[4]=(...t)=>o.passClick&&o.passClick(...t))},"รหัสผ่าน",2),r(n,{modelValue:a.data.password,"onUpdate:modelValue":s[5]||(s[5]=t=>a.data.password=t),name:"password",type:"password",classN:"input-login",rules:"required",iconN:"eye",onFocusin:s[6]||(s[6]=t=>a.focusPassword=!0),onFocusout:s[7]||(s[7]=t=>a.focusPassword=!1)},null,8,["modelValue"])]),e("div",{class:"re-password pointer",onClick:s[8]||(s[8]=t=>o.repasswordClick())},"ลืมรหัสผ่าน?"),s[11]||(s[11]=e("div",{class:"group-button"},[e("button",{type:"submit",class:"button-login"},"เข้าสู่ระบบ")],-1))]),_:1},8,["onInvalidSubmit"])]),b(e("div",U,[e("div",j,[e("div",J,[s[14]||(s[14]=V('<div class="modal-detail"><div class="image-icon"><img src="'+L+'" alt="" class="image-confirm"></div><div class="title-size">กรุณาติดต่อผู้ดูแลระบบเพื่อทำการเปลี่ยนรหัสผ่าน</div><div class="message">Email : xxxxx123@gmail.com</div><div class="message">โทร : 0xx-xxx-xxxx</div></div>',1)),e("div",O,[e("button",{type:"button",onClick:s[10]||(s[10]=(...t)=>o.closeModalRepass&&o.closeModalRepass(...t)),class:"button-confirm button-success"},s[13]||(s[13]=[e("div",{class:"group-name"},[e("img",{src:q,alt:"",class:"image-times"}),e("div",{class:"name"},"ปิด")],-1)]))])])])],512),[[N,a.modalRepass]]),r(i,{modalAlert:a.modalAlert},null,8,["modalAlert"]),r(m,{show:a.showLoading},null,8,["show"])])}const H=I(M,[["render",T]]);export{H as default};

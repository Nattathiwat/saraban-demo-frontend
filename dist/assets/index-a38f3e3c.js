import{_ as U}from"./users-cog-duotone-07583f70.js";import{_ as A,r as h,o as c,c as _,a as t,b as i,d as K,F as b,h as k,i as I,e as N,j as S,n as v,t as r}from"./index-dcf116f4.js";const V="/assets/envelope-solid-0defb60b.svg",F="/assets/share-from-square-solid-a7b0a20b.svg";const M={name:"mail-manage-inex",data(){return{modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,data:{search:"",table:[],page:1,total:0,lastPage:0,perPage:10,regis_id:"",department_id:"",department_dest_id:""},optionSelect:{regis_id:[],department_id:[],department_dest_id:[]}}},methods:{sendmailClick(o){this.$router.push({name:"automail-sendmail-edit",params:{id:o.id},query:{page:this.data.page,perPage:this.data.perPage}}).catch(()=>{})},listClick(o){this.$router.push({name:"automail-sendmail-list",params:{id:o.book_regis_id},query:{page:this.data.page,perPage:this.data.perPage}}).catch(()=>{})},pageChange(o){this.data.perPage=o.perPage,this.data.page=o.page,this.apiSendmailLists()},cancelClick(){this.data.regis_id="",this.data.department_id="",this.data.department_dest_id="",this.data.document_number="",this.data.name="",this.data.start_date="",this.data.end_date=""},search(){this.data.status=!0,this.data.perPage=10,this.data.page=1,this.apiSendmailLists()},apiSendmailLists(){this.data.table=[],this.showLoading=!0,this.axios.get("/book-out-external/book-out-automail",{params:{regis_id:this.data.regis_id,department_id:this.data.department_id,department_dest_id:this.data.department_dest_id,page_size:this.data.perPage,page:this.data.page,user_id:parseInt(localStorage.getItem("user_id")),document_number:this.data.document_number,name:this.data.name,start_date:this.data.start_date,end_date:this.data.end_date}}).then(o=>{this.showLoading=!1,o.data.data.meta.filter(e=>{let a=0;e.book_series.filter(g=>{a+=g.subs.length}),a+=e.book_series.length,a+=1,e.rowspan=a}),this.data.table=o.data.data.meta,this.data.total=o.data.data.total,this.data.lastPage=Math.ceil(this.data.total/this.data.perPage)}).catch(o=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:o.response.data.message}})},api_master(){this.showLoading=!0;const o=this.axios.get("/master-data/book-category",{params:{book_type:2}}),e=this.axios.get("/master-data/department-user",{params:{type:1}});this.axios.all([o,e]).then(this.axios.spread((...a)=>{var n,m;this.showLoading=!1;const g=a[0],s=a[1];(n=g.data.data)==null||n.filter(l=>(l.value=l.id,l.name=l.name,l)),(m=s.data.data)==null||m.filter(l=>(l.value=l.id,l.name=l.desc,l.human_flag=l.human_flag,l.response_type=l.type,l)),this.optionSelect.regis_id=g.data.data,this.optionSelect.department_id=s.data.data,this.optionSelect.department_dest_id=s.data.data,this.apiSendmailLists()})).catch(a=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:a.response.data.message}})},keyup_regis_type(o){this.optionSelect.regis_id=[],this.axios.get("/master-data/book-category",{params:{keyword:o.target.value,book_type:2}}).then(e=>{e.data.data&&(e.data.data.filter(a=>(a.value=a.id,a.name=a.name,a)),this.optionSelect.regis_id=e.data.data)})},keyup_department(o){this.optionSelect.department_id=[],this.axios.get("/master-data/department-user",{params:{keyword:o.target.value,type:1}}).then(e=>{e.data.data&&(e.data.data.filter(a=>(a.value=a.id,a.name=a.desc,a.human_flag=a.human_flag,a.response_type=a.type,a)),this.optionSelect.department_id=e.data.data)})},keyup_department_desc(o){this.optionSelect.department_dest_id=[],this.axios.get("/master-data/department-user",{params:{keyword:o.target.value,type:1}}).then(e=>{e.data.data&&(e.data.data.filter(a=>(a.value=a.id,a.name=a.desc,a.human_flag=a.human_flag,a.response_type=a.type,a)),this.optionSelect.department_dest_id=e.data.data)})}},mounted(){var o,e;this.data.page=((o=this.$route.query)==null?void 0:o.page)||this.data.page,this.data.perPage=((e=this.$route.query)==null?void 0:e.perPage)||this.data.perPage,this.api_master()}},B={class:"mail-inex"},E={class:"group-overflow"},j={class:"detail"},z=N('<div class="group-head"><div class="group-first"><img src="'+U+'" alt="" class="icon-users-cog"><div class="name">รายการหนังสือส่งออก ที่ส่งผ่านอีเมลอัตโนมัติ</div></div></div><div class="line"></div>',2),D={class:"group-detail"},T={class:"group-between"},G={class:"group-input left"},H=t("div",{class:"name"},"ทะเบียน",-1),J={class:"group-input"},O=t("div",{class:"name"},"เลขออกหนังสือส่งออก",-1),Q={class:"group-between"},R={class:"group-input"},W=t("div",{class:"name"},"เรื่อง",-1),X={class:"group-between"},Y={class:"group-input left"},Z=t("div",{class:"name"},"จาก",-1),$={class:"group-input"},tt=t("div",{class:"name"},"ถึง",-1),et={class:"group-between"},at={class:"group-input left"},st=t("div",{class:"name"},"จากวันที่",-1),ot={class:"group-input"},dt=t("div",{class:"name"},"ถึงวันที่",-1),lt={class:"group-button"},nt={class:"button-left"},it=t("i",{class:"bi bi-arrow-clockwise icon-clockwise"},null,-1),rt=t("div",{class:"button-right"},[t("button",{type:"submit",class:"button-search"},[t("i",{class:"bi bi-search icon-search"}),S(" ค้นหา ")])],-1),ct={class:"group-body"},_t={class:"table-department-inex"},pt=t("thead",{class:"thead"},[t("tr",{class:"thead-row"},[t("th",{class:"col1"},"ลำดับ"),t("th",{class:"col2"},"ความเร่งด่วน"),t("th",{class:"col3"},"ชั้นความลับ"),t("th",{class:"col4"},"เลขออกหนังสือส่งออก"),t("th",{class:"col5"},"ทะเบียนหนังสือ"),t("th",{class:"col6"},"ชื่อเรื่อง"),t("th",{class:"col7"},"ชนิดหนังสือ"),t("th",{class:"col8"},"ลงวันที่"),t("th",{class:"col9"},"จาก"),t("th",{class:"col10"},"ถึง"),t("th",{class:"col11"},[t("img",{src:V,alt:"",class:"icon-send"})])])],-1),ut={class:"tbody"},ht=["rowspan"],mt={class:"col2"},gt={class:"col3",colspan:"3"},bt={class:"col6"},vt={class:"col7 text-start",colspan:"4"},yt=t("td",{class:"col11"},null,-1),kt={colspan:"9",class:"col2",style:{"text-align":"left"}},ft={class:"col11"},wt={class:"group-icon"},St=["onClick"],Vt={class:"col3",colspan:"3"},Pt={style:{width:"140px"},class:"ms-auto"},Ct={class:"col4 text-start",colspan:"3"},xt={class:"col7"},Lt={class:"col8"},qt={class:"col9"},Ut={class:"col11"},At={class:"group-icon"},Kt=["onClick"],It={key:0,class:"tbody-row"},Nt=t("td",{colspan:"11"},"ไม่มีข้อมูล",-1),Ft=[Nt],Mt={class:"group-footer"};function Bt(o,e,a,g,s,n){const m=h("cpn-autoComplete"),l=h("cpn-input"),f=h("cpn-datepicker"),P=h("Form"),C=h("cpn-pagination"),x=h("cpn-modal-alert"),L=h("cpn-loading");return c(),_("div",B,[t("div",E,[t("div",j,[z,i(P,{onSubmit:n.apiSendmailLists,onInvalidSubmit:o.onInvalidSubmit},{default:K(()=>[t("div",D,[t("div",T,[t("div",G,[H,i(m,{modelValue:s.data.regis_id,"onUpdate:modelValue":e[0]||(e[0]=d=>s.data.regis_id=d),name:"regis_id",onKeyup:n.keyup_regis_type,optionSelect:s.optionSelect.regis_id,placeholder:"กรุณาระบุ"},null,8,["modelValue","onKeyup","optionSelect"])]),t("div",J,[O,i(l,{modelValue:s.data.document_number,"onUpdate:modelValue":e[1]||(e[1]=d=>s.data.document_number=d),name:"document_number",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",Q,[t("div",R,[W,i(l,{modelValue:s.data.name,"onUpdate:modelValue":e[2]||(e[2]=d=>s.data.name=d),name:"name",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",X,[t("div",Y,[Z,i(m,{modelValue:s.data.department_id,"onUpdate:modelValue":e[3]||(e[3]=d=>s.data.department_id=d),name:"department_id",onKeyup:n.keyup_department,optionSelect:s.optionSelect.department_id,placeholder:"กรุณาระบุ"},null,8,["modelValue","onKeyup","optionSelect"])]),t("div",$,[tt,i(m,{modelValue:s.data.department_dest_id,"onUpdate:modelValue":e[4]||(e[4]=d=>s.data.department_dest_id=d),name:"department_dest_id",onKeyup:n.keyup_department_desc,optionSelect:s.optionSelect.department_dest_id,placeholder:"เลือกหน่วยงานปลายทาง"},null,8,["modelValue","onKeyup","optionSelect"])])]),t("div",et,[t("div",at,[st,i(f,{modelValue:s.data.start_date,"onUpdate:modelValue":e[5]||(e[5]=d=>s.data.start_date=d),name:"start_date",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",ot,[dt,i(f,{modelValue:s.data.end_date,"onUpdate:modelValue":e[6]||(e[6]=d=>s.data.end_date=d),name:"end_date",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",lt,[t("div",nt,[t("button",{type:"button",class:"button-warning",onClick:e[7]||(e[7]=d=>n.cancelClick())},[it,S(" ล้างการค้นหา ")])]),rt])])]),_:1},8,["onSubmit","onInvalidSubmit"]),t("div",ct,[t("table",_t,[pt,t("tbody",ut,[(c(!0),_(b,null,k(s.data.table,(d,p)=>(c(),_(b,{key:p},[t("tr",{class:v(["tbody-row tbody-row-index",p%2!=0?"color-tr1":"color-tr2"])},[t("td",{class:v(["col1",p%2!=0?"color-tr1":"color-tr2"]),rowspan:d.rowspan},r(p+1+s.data.perPage*(s.data.page-1)),11,ht),t("td",mt,r(d.speed_name),1),t("td",gt,r(d.secret_name),1),t("td",bt,r(d.subject),1),t("td",vt,r(d.book_type_name),1),yt],2),(c(!0),_(b,null,k(d.book_series,(y,q)=>(c(),_(b,{key:q},[t("tr",{class:v(["tbody-row",p%2==0?"color-tr2":"color-tr1"])},[t("td",kt," ชุดที่ #"+r(y.no),1),t("td",ft,[t("div",wt,[t("img",{onClick:u=>n.listClick(y),src:F,alt:"",class:"icon-send pointer"},null,8,St)])])],2),(c(!0),_(b,null,k(y.subs,(u,w)=>(c(),_("tr",{class:v(["tbody-row",(w%2!=0,p%2==0?"color-tr2":"color-tr1")]),key:w},[t("td",Vt,[t("div",Pt,r(u.book_out_document_number),1)]),t("td",Ct,r(u.book_regis_name),1),t("td",xt,r(u.as_of_date),1),t("td",Lt,r(u.from),1),t("td",qt,r(u.to),1),t("td",Ut,[t("div",At,[t("img",{onClick:Et=>n.sendmailClick(u),src:V,alt:"",class:"icon-send pointer"},null,8,Kt)])])],2))),128))],64))),128))],64))),128)),s.data.table.length==0?(c(),_("tr",It,Ft)):I("",!0)])])]),t("div",Mt,[i(C,{page:s.data.page,total:s.data.total,lastPage:s.data.lastPage,perPage:s.data.perPage,onPageChange:n.pageChange},null,8,["page","total","lastPage","perPage","onPageChange"])])])]),i(x,{modalAlert:s.modalAlert},null,8,["modalAlert"]),i(L,{show:s.showLoading},null,8,["show"])])}const Dt=A(M,[["render",Bt]]);export{Dt as default};

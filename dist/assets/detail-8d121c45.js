import{_ as U,l as x,r as y,o as m,c as g,a as t,t as w,j as u,b as p,d as C,w as S,v as V,m as z,i as q,F as j,h as A,n as L,g as F,k as M}from"./index-4296622d.js";import{_ as T,a as R,b as B}from"./line-up-32057639.js";import{_ as D}from"./user-crown-duotone-30417741.js";const E="/assets/crown-duotone-c5406971.svg",K="/assets/user-crown-duotoneffffff-d1278e98.svg";const O={name:"user-manage-detail",data(){return{modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,edit:!1,data:{previewImage1:"",previewImage2:"",profile_img:"",signature_img:"",fname:"",lname:"",username:"",password:"",email:"",department_id:"",organization_id:"",subministry_id:"",group_id:"",level:[],birthdate:"",optionSelect:{organization:[],department:[],subministry:[],group:[],roles:[]},fileType:[]}}},components:{date:x},methods:{selectImage(a){this.$refs[a].click()},pickFile(a){for(var e=0;e<this.$refs[a].files.length;e++){let s=this.$refs[a].files[e];if(this.data.fileType.indexOf(s.type)==-1)return this.modalAlert={showModal:!0,type:"error",message:this.defaultMessageErrorFile},!1;(s.type=="image/jpeg"||s.type=="image/png")&&s.size<5e5?(a=="fileInput1"?(this.data.previewImage1=URL.createObjectURL(s),this.data.profile_img=s):(this.data.previewImage2=URL.createObjectURL(s),this.data.signature_img=s),this.$refs[a].value=null):this.modalAlert={showModal:!0,type:"error",title:"Error",message:"*ไฟล์ที่อัพโหลดได้ png, jpg และ jpeg ขนาดไม่เดิน 500 KB"}}},keyupOrganization(a){this.data.optionSelect.organization=[],this.axios.get("/organization",{params:{keyword:a.target.value}}).then(e=>{e.data.data&&(e.data.data.filter(s=>(s.value=s.id,s)),this.data.optionSelect.organization=e.data.data)})},keyupDepartment(a){this.data.optionSelect.department=[],this.axios.get("/master-data/department",{params:{keyword:a.target.value}}).then(e=>{e.data.data&&(e.data.data.filter(s=>(s.value=s.id,s.name=s.department_full_name,s)),this.data.optionSelect.department=e.data.data)})},keyupSubministry(a){this.data.optionSelect.subministry=[],this.axios.get("/subministry",{params:{keyword:a.target.value}}).then(e=>{e.data.data&&(e.data.data.filter(s=>(s.value=s.id,s.name=s.Name,s)),this.data.optionSelect.subministry=e.data.data)})},keyupGroup(a){this.data.optionSelect.group=[],this.axios.get("/group",{params:{keyword:a.target.value}}).then(e=>{e.data.data&&(e.data.data.filter(s=>(s.value=s.id,s)),this.data.optionSelect.group=e.data.data)})},changeGroup(a){this.data.optionSelect.group.filter(e=>{e.id==a&&(this.data.optionSelect.organization.push({value:e.organization_id,name:e.organization_name}),this.data.organization_id=e.organization_id,this.data.optionSelect.department.push({value:e.department_id,name:e.department_name}),this.data.department_id=e.department_id,this.data.optionSelect.subministry.push({value:e.subministry_id,name:e.subministry_name}),this.data.subministry_id=e.subministry_id)})},back(){this.$router.push({name:"user-manage",query:{page:this.$route.query.page,perPage:this.$route.query.perPage}}).catch(()=>{})},cancelClick(){this.back(),this.data.previewImage1="",this.data.previewImage2="",this.data.profile_img="",this.data.signature_img="",this.data.username="",this.data.password="",this.data.email="",this.data.organization_id="",this.data.department_id="",this.data.subministry_id="",this.data.group_id="",this.data.level=[],this.data.birthdate="",this.data.fileType=[]},onSubmit(){let a=this;(!this.data.profile_img||!this.data.signature_img)&&!this.edit?document.querySelector('[name="fileInput1"]').scrollIntoView({block:"center"}):this.modalAlert={showModal:!0,type:"confirm",title:`คุณยืนยันการ${this.edit?"แก้ไขผู้ใช้งาน":"สร้างผู้ใช้งาน"}หรือไม่`,confirm:!0,msgSuccess:!0,afterPressAgree(){var b,o,n,l,c,h,_,f,i,v,d,I;let e=[];a.data.level.filter(r=>{r.flag="delete",e.push(r)}),a.data.optionSelect.roles.filter(r=>{r.flag="add",r.check&&e.push(r)});let s=new FormData;s.append("fname",((b=a.data)==null?void 0:b.fname)||""),s.append("lname",((o=a.data)==null?void 0:o.lname)||""),s.append("email",((n=a.data)==null?void 0:n.email)||""),s.append("department_id",((l=a.data)==null?void 0:l.department_id)||""),s.append("organization_id",((c=a.data)==null?void 0:c.organization_id)||""),s.append("subministry_id",((h=a.data)==null?void 0:h.subministry_id)||""),s.append("group_id",((_=a.data)==null?void 0:_.group_id)||""),s.append("username",((f=a.data)==null?void 0:f.username)||""),s.append("password",((i=a.data)==null?void 0:i.password)||""),s.append("birthdate",((v=a.data)==null?void 0:v.birthdate)||""),s.append("profile_img",((d=a.data)==null?void 0:d.profile_img)||""),s.append("signature_img",((I=a.data)==null?void 0:I.signature_img)||""),s.append("total_role",(e==null?void 0:e.length)||0),e.filter((r,k)=>{r.id&&s.append(`roles[${k}][id]`,r.id),r.role_id&&s.append(`roles[${k}][role_id]`,r.role_id),r.flag&&s.append(`roles[${k}][flag]`,r.flag)}),a.showLoading=!0,a.axios[a.edit?"put":"post"](`/user${a.edit?"/"+a.$route.params.id:""}`,s,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{a.showLoading=!1,a.modalAlert={showModal:!0,type:"success",title:a.edit?"ทำการแก้ไขผู้ใช้งานสำเร็จแล้ว":"ทำการสร้างผู้ใช้งานสำเร็จแล้ว",msgSuccess:!0,afterPressAgree(){a.back()}}}).catch(r=>{a.showLoading=!1,a.modalAlert={showModal:!0,type:"error",title:"Error",message:r.response.data.message}})}}},apiDetail(){this.showLoading=!0,this.axios.get(`/user/${this.$route.params.id}`).then(a=>{this.showLoading=!1,this.data.fname=a.data.data.fname,this.data.lname=a.data.data.lname,this.data.username=a.data.data.username,this.data.password=a.data.data.password,this.data.email=a.data.data.email,this.data.department_id=a.data.data.department_id,this.data.organization_id=a.data.data.organization_id,this.data.subministry_id=a.data.data.subministry_id,this.data.group_id=a.data.data.group_id,this.data.birthdate=a.data.data.birthdate,this.data.level=a.data.data.roles,this.axios({method:"get",url:this.backendport+"/"+a.data.data.profile_img,baseURL:"",responseType:"blob"}).then(e=>{const s=new Blob([e.data],{type:this.assetsUtils.getTypeFile(a.data.data.profile_img)});this.data.previewImage1=URL.createObjectURL(s)}),this.axios({method:"get",url:this.backendport+"/"+a.data.data.signature_img,baseURL:"",responseType:"blob"}).then(e=>{const s=new Blob([e.data],{type:this.assetsUtils.getTypeFile(a.data.data.signature_img)});this.data.previewImage2=URL.createObjectURL(s)}),this.data.optionSelect.roles.filter(e=>{e.check=!1,a.data.data.roles.filter(s=>{s.role_id==e.role_id&&(e.check=!0)})})}).catch(a=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:a.response.data.message}})},apiMaster(){this.showLoading=!0;const a=this.axios.get("/master-data/department"),e=this.axios.get("/master-data/role"),s=this.axios.get("/organization?page_size=100"),b=this.axios.get("/subministry?page_size=100"),o=this.axios.get("/group?page_size=100"),n=this.axios.get("/filetype?keyword=&page_size=50&page=1");this.axios.all([a,e,s,b,o,n]).then(this.axios.spread((...l)=>{this.showLoading=!1;const c=l[0],h=l[1],_=l[2],f=l[3],i=l[4],v=l[5];c.data.data.filter(d=>(d.value=d.id,d.name=d.department_full_name,d)),h.data.data.filter(d=>(d.role_id=d.id,d)),_.data.data.filter(d=>(d.value=d.id,d)),f.data.data.filter(d=>(d.value=d.id,d.name=d.Name,d)),i.data.data.filter(d=>(d.value=d.id,d)),this.data.optionSelect.department=c.data.data,this.data.optionSelect.roles=h.data.data,this.data.optionSelect.organization=_.data.data,this.data.optionSelect.subministry=f.data.data,this.data.optionSelect.group=i.data.data,this.data.fileType=[],v.data.data.filter(d=>{d.active_flag==1&&this.data.fileType.push(d.content_type)}),this.$route.params.id?(this.edit=!0,this.apiDetail()):this.edit=!1})).catch(l=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:l.response.data.message}})}},mounted(){this.apiMaster()}},N={class:"user-detail"},G={class:"group-overflow"},P={class:"detail"},H={class:"group-head"},J={class:"group-first"},Q=t("img",{src:T,alt:"",class:"icon-users"},null,-1),W={class:"name"},X={class:"group-end"},Y=t("img",{src:R,class:"icon-back"},null,-1),Z=t("img",{src:B,class:"icon-line"},null,-1),$=t("div",{class:"line"},null,-1),ee={class:"group-detail"},te={class:"group-between"},ae={class:"group-image left"},se=t("div",{class:"name"},[u("โปรไฟล์ "),t("span",{class:"required"},"*")],-1),ie=t("div",{class:"warning-message"},"*ไฟล์ที่อัพโหลดได้ png, jpg และ jpeg ขนาดไม่เดิน 500 KB",-1),oe={class:"group-image"},de=t("div",{class:"name"},[u("ลายเซ็น "),t("span",{class:"required"},"*")],-1),ne=t("div",{class:"warning-message"},"*ไฟล์ที่อัพโหลดได้ png, jpg และ jpeg ขนาดไม่เดิน 500 KB",-1),le={class:"group-between"},re={class:"group-input left"},pe=t("div",{class:"name"},[u("ชื่อ "),t("span",{class:"required"},"*")],-1),ue={class:"group-input"},ce=t("div",{class:"name"},[u("นามสกุล "),t("span",{class:"required"},"*")],-1),me={class:"group-between"},ge={class:"group-input left"},he={class:"name"},_e={key:0,class:"required"},fe={class:"group-input"},ve={class:"name"},be={key:0,class:"required"},ye={class:"group-between"},we={class:"group-input left"},ke=t("div",{class:"name"},[u("Email "),t("span",{class:"required"},"*")],-1),Se=t("div",{class:"group-input"},null,-1),Ve={class:"group-between"},Ie={class:"group-input left"},ze=t("div",{class:"name"},"กระทรวง",-1),qe={class:"group-input"},Le=t("div",{class:"name"},"หน่วยงาน",-1),Ue={class:"group-between"},xe={class:"group-input left"},Ce=t("div",{class:"name"},"กอง",-1),je={class:"group-input"},Ae=t("div",{class:"name"},[u("กลุ่ม "),t("span",{class:"required"},"*")],-1),Fe={class:"group-level"},Me=t("div",{class:"level-first"},[t("img",{src:E,alt:"",class:"icon-crown"}),t("div",{class:"name"},"สิทธิ์")],-1),Te={class:"level-button"},Re=["onClick"],Be={class:"group-user"},De={key:0,src:K,alt:"",class:"icon-user-crown"},Ee={key:1,src:D,alt:"",class:"icon-user-crown"},Ke=["onClick"],Oe=t("div",{class:"line"},null,-1),Ne={class:"group-footer"},Ge={class:"footer-left"},Pe=t("img",{src:F,alt:"times-circle",class:"icon-times-circle"},null,-1),He={class:"footer-right"},Je={type:"submit",class:"button-success"},Qe=t("img",{src:M,alt:"times-circle",class:"icon-check-circle"},null,-1);function We(a,e,s,b,o,n){const l=y("cpn-input"),c=y("cpn-autoComplete"),h=y("Form"),_=y("cpn-modal-alert"),f=y("cpn-loading");return m(),g("div",N,[t("div",G,[t("div",P,[t("div",H,[t("div",J,[Q,t("div",W,w(o.edit?"แก้ไขผู้ใช้งาน":"สร้างผู้ใช้งาน"),1)]),t("div",X,[t("button",{type:"button",class:"button-back",onClick:e[0]||(e[0]=i=>n.back())},[Y,Z,u(" ย้อนกลับ ")])])]),$,p(h,{onSubmit:n.onSubmit,onInvalidSubmit:a.onInvalidSubmit},{default:C(()=>[t("div",ee,[t("div",te,[t("div",ae,[se,S(t("div",{class:"image-preview-wrapper",style:z({"background-image":`url(${o.data.previewImage1})`})},null,4),[[V,o.data.previewImage1]]),t("input",{ref:"fileInput1",type:"file",onInput:e[1]||(e[1]=i=>n.pickFile("fileInput1")),accept:"image/png, image/jpg, image/jpeg",style:{display:"none"}},null,544),t("button",{name:"fileInput1",type:"button",onClick:e[2]||(e[2]=i=>n.selectImage("fileInput1")),class:"button-image"},"เลือกรูปภาพ"),ie]),t("div",oe,[de,S(t("div",{class:"image-preview-wrapper",style:z({"background-image":`url(${o.data.previewImage2})`})},null,4),[[V,o.data.previewImage2]]),t("input",{ref:"fileInput2",type:"file",onInput:e[3]||(e[3]=i=>n.pickFile("fileInput2")),accept:"image/png, image/jpg, image/jpeg",style:{display:"none"}},null,544),t("button",{name:"fileInput2",type:"button",onClick:e[4]||(e[4]=i=>n.selectImage("fileInput2")),class:"button-image"},"เลือกรูปภาพ"),ne])]),t("div",le,[t("div",re,[pe,p(l,{modelValue:o.data.fname,"onUpdate:modelValue":e[5]||(e[5]=i=>o.data.fname=i),name:"fname",rules:"required",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",ue,[ce,p(l,{modelValue:o.data.lname,"onUpdate:modelValue":e[6]||(e[6]=i=>o.data.lname=i),name:"lname",rules:"required",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",me,[t("div",ge,[t("div",he,[u("ชื่อผู้ใช้งาน "),o.edit?q("",!0):(m(),g("span",_e,"*"))]),p(l,{modelValue:o.data.username,"onUpdate:modelValue":e[7]||(e[7]=i=>o.data.username=i),name:"Usern",rules:o.edit?"":"required",disabled:o.edit,placeholder:"กรุณาระบุ"},null,8,["modelValue","rules","disabled"])]),t("div",fe,[t("div",ve,[u("รหัสผ่าน "),o.edit?q("",!0):(m(),g("span",be,"*"))]),p(l,{modelValue:o.data.password,"onUpdate:modelValue":e[8]||(e[8]=i=>o.data.password=i),name:"passw",type:"password",rules:o.edit?"":"required",disabled:o.edit,placeholder:"กรุณาระบุ"},null,8,["modelValue","rules","disabled"])])]),t("div",ye,[t("div",we,[ke,p(l,{modelValue:o.data.email,"onUpdate:modelValue":e[9]||(e[9]=i=>o.data.email=i),name:"email",rules:"required|email",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),Se]),t("div",Ve,[t("div",Ie,[ze,p(c,{modelValue:o.data.organization_id,"onUpdate:modelValue":e[10]||(e[10]=i=>o.data.organization_id=i),name:"organization",placeholder:"กรุณาระบุ",disabled:!0,onKeyup:e[11]||(e[11]=i=>n.keyupOrganization(i)),optionSelect:o.data.optionSelect.organization},null,8,["modelValue","optionSelect"])]),t("div",qe,[Le,p(c,{modelValue:o.data.department_id,"onUpdate:modelValue":e[12]||(e[12]=i=>o.data.department_id=i),name:"department",placeholder:"กรุณาระบุ",disabled:!0,onKeyup:e[13]||(e[13]=i=>n.keyupDepartment(i)),optionSelect:o.data.optionSelect.department},null,8,["modelValue","optionSelect"])])]),t("div",Ue,[t("div",xe,[Ce,p(c,{modelValue:o.data.subministry_id,"onUpdate:modelValue":e[14]||(e[14]=i=>o.data.subministry_id=i),name:"subministry",placeholder:"กรุณาระบุ",disabled:!0,onKeyup:e[15]||(e[15]=i=>n.keyupSubministry(i)),optionSelect:o.data.optionSelect.subministry},null,8,["modelValue","optionSelect"])]),t("div",je,[Ae,p(c,{modelValue:o.data.group_id,"onUpdate:modelValue":e[16]||(e[16]=i=>o.data.group_id=i),name:"group",placeholder:"กรุณาระบุ",rules:"required",onKeyup:e[17]||(e[17]=i=>n.keyupGroup(i)),onChange:n.changeGroup,optionSelect:o.data.optionSelect.group},null,8,["modelValue","onChange","optionSelect"])])])]),S(t("div",Fe,[Me,t("div",Te,[(m(!0),g(j,null,A(o.data.optionSelect.roles,(i,v)=>(m(),g("div",{key:v},[i.id==1?(m(),g("button",{key:0,type:"button",class:L(["button-admin",i.check?"active":""]),onClick:d=>i.check=!i.check},[t("div",Be,[i.check?(m(),g("img",De)):(m(),g("img",Ee)),u(" "+w(i.desc),1)])],10,Re)):(m(),g("button",{key:1,type:"button",class:L(["button-roles",i.check?"active":""]),onClick:d=>i.check=!i.check},w(i.desc),11,Ke))]))),128))])],512),[[V,o.data.optionSelect.roles.length>0]]),Oe,t("div",Ne,[t("div",Ge,[t("button",{type:"button",class:"button-danger",onClick:e[18]||(e[18]=i=>n.cancelClick())},[Pe,u(" ยกเลิก ")])]),t("div",He,[t("button",Je,[Qe,u(" "+w(o.edit?"ยืนยันแก้ไขผู้ใช้งาน":"ยืนยันสร้างผู้ใช้งาน"),1)])])])]),_:1},8,["onSubmit","onInvalidSubmit"])])]),p(_,{modalAlert:o.modalAlert},null,8,["modalAlert"]),p(f,{show:o.showLoading},null,8,["show"])])}const $e=U(O,[["render",We]]);export{$e as default};

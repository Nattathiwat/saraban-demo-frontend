import{_ as f}from"./users-duotone-57e3c13d.js";import{_ as w,a as S}from"./line-up-c54e1bbb.js";import{_ as b,r as n,o as V,c as y,a as e,t as k,h as p,b as l,d as x,f as L,k as A}from"./index-6f9b4dc9.js";const M={name:"email-agency-detail",data(){return{modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,edit:!1,data:{department_id:"",deliver_method_id:"",smtp_username:"",smtp_password:"",smtp_server:"",smtp_port:"",smtp_hello_domain:"",smtp_authen_id:"",is_start_tls:!1,is_ssl_connection:!1},optionSelect:{department_id:[],deliver_method_id:[],smtp_authen_id:[]}}},methods:{testmailClick(){var t;this.showLoading=!0;let s={department_id:parseInt(this.data.department_id),department_name:(t=this.optionSelect.department_id.filter(i=>i.value==this.data.department_id))==null?void 0:t[0].name,deliver_method_id:parseInt(this.data.deliver_method_id),smtp_username:this.data.smtp_username,smtp_server:this.data.smtp_server,smtp_password:this.data.smtp_password,smtp_port:this.data.smtp_port,smtp_hello_domain:this.data.smtp_hello_domain,smtp_authen_id:parseInt(this.data.smtp_authen_id),is_start_tls:this.data.is_start_tls,is_ssl_connection:this.data.is_ssl_connection,user_id:parseInt(localStorage.getItem("user_id"))};this.axios.post("/email-config/testing",s).then(i=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"success",title:i.data.message,message:i.data.data}}).catch(i=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:i.response.data.message}})},back(){this.$router.push({name:"email-agency",query:{page:this.$route.query.page,perPage:this.$route.query.perPage}}).catch(()=>{})},cancelClick(){this.back(),this.data.department_id="",this.data.deliver_method_id="",this.data.smtp_username="",this.data.smtp_password="",this.data.smtp_server="",this.data.smtp_port="",this.data.smtp_hello_domain="",this.data.smtp_authen_id="",this.data.is_start_tls=!1,this.data.is_ssl_connection=!1},onSubmit(){let s=this;this.modalAlert={showModal:!0,type:"confirm",title:`คุณยืนยันการ${this.edit?"แก้ไขหน่วยงาน":"สร้างหน่วยงาน"}หรือไม่`,confirm:!0,msgSuccess:!0,afterPressAgree(){var i;let t={department_id:parseInt(s.data.department_id),department_name:(i=s.optionSelect.department_id.filter(d=>d.value==s.data.department_id))==null?void 0:i[0].name,deliver_method_id:parseInt(s.data.deliver_method_id),smtp_username:s.data.smtp_username,smtp_server:s.data.smtp_server,smtp_password:s.data.smtp_password,smtp_port:s.data.smtp_port,smtp_hello_domain:s.data.smtp_hello_domain,smtp_authen_id:parseInt(s.data.smtp_authen_id),is_start_tls:s.data.is_start_tls,is_ssl_connection:s.data.is_ssl_connection,user_id:parseInt(localStorage.getItem("user_id"))};s.showLoading=!0,s.axios[s.edit?"put":"post"](`/email-config${s.edit?"/"+s.$route.params.id:""}`,t).then(()=>{s.showLoading=!1,s.modalAlert={showModal:!0,type:"success",title:s.edit?"ทำการแก้ไขหน่วยงานสำเร็จแล้ว":"ทำการสร้างหน่วยงานสำเร็จแล้ว",msgSuccess:!0,afterPressAgree(){s.back()}}}).catch(d=>{s.showLoading=!1,s.modalAlert={showModal:!0,type:"error",title:"Error",message:d.response.data.message}})}}},apiDetail(){this.showLoading=!0,this.axios.get(`/email-config/${this.$route.params.id}`).then(s=>{this.showLoading=!1,this.data={...this.data,...s.data.data}}).catch(s=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:s.response.data.message}})},api_master(){this.showLoading=!0;const s=this.axios.get("/master-data/department");this.axios.all([s]).then(this.axios.spread((...t)=>{this.showLoading=!1;const i=t[0];i.data.data.filter(d=>(d.value=d.id,d.name=d.department_full_name,d)),this.optionSelect.department_id=i.data.data,this.optionSelect.deliver_method_id=[{value:1,name:"smtp"}],this.optionSelect.smtp_authen_id=[{value:1,name:"login"}],this.$route.params.id?(this.edit=!0,this.apiDetail()):this.edit=!1})).catch(t=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:t.response.data.message}})},keyupDepartment(s){this.optionSelect.department_id=[],this.axios.get("/master-data/department",{params:{keyword:s.target.value}}).then(t=>{t.data.data&&(t.data.data.filter(i=>(i.value=i.id,i.name=i.department_full_name,i)),this.optionSelect.department_id=t.data.data)})}},mounted(){this.api_master()}},I={class:"master-email-agency-detail"},C={class:"group-overflow"},U={class:"detail"},P={class:"group-head"},T={class:"group-first"},E={class:"name"},q={class:"group-end"},D={class:"group-detail"},B={class:"group-between"},N={class:"group-input left"},F={class:"group-between"},H={class:"group-input"},K={class:"group-input"},O={class:"group-input"},R={class:"group-between"},j={class:"group-input"},z={class:"group-input"},G={class:"group-input"},J={class:"group-between"},Q={class:"group-input"},W={class:"group-input d-flex align-items-center mb-0"},X={class:"group-input d-flex align-items-center mb-0"},Y={class:"group-footer"},Z={class:"footer-left"},$={class:"footer-right"};function tt(s,t,i,d,a,r){const c=n("cpn-autoComplete"),_=n("cpn-select"),m=n("cpn-input"),u=n("cpn-checkbox"),h=n("Form"),g=n("cpn-modal-alert"),v=n("cpn-loading");return V(),y("div",I,[e("div",C,[e("div",U,[e("div",P,[e("div",T,[t[14]||(t[14]=e("img",{src:f,alt:"",class:"icon-users"},null,-1)),e("div",E,k(a.edit?"แก้ไขอีเมลสำหรับส่งหนังสือของหน่วยงาน":"สร้างอีเมลสำหรับส่งหนังสือของหน่วยงาน"),1)]),e("div",q,[e("button",{type:"button",class:"button-back",onClick:t[0]||(t[0]=o=>r.back())},t[15]||(t[15]=[e("img",{src:w,class:"icon-back"},null,-1),e("img",{src:S,class:"icon-line"},null,-1),p(" ย้อนกลับ ")]))])]),t[30]||(t[30]=e("div",{class:"line"},null,-1)),l(h,{onSubmit:r.onSubmit,onInvalidSubmit:s.onInvalidSubmit},{default:x(()=>[e("div",D,[e("div",B,[e("div",N,[t[16]||(t[16]=e("div",{class:"name"},[p("หน่วยงาน "),e("span",{class:"required"},"*")],-1)),l(c,{modelValue:a.data.department_id,"onUpdate:modelValue":t[1]||(t[1]=o=>a.data.department_id=o),name:"department_id",rules:"required",placeholder:"กรุณาระบุ",optionSelect:a.optionSelect.department_id,onKeyup:t[2]||(t[2]=o=>r.keyupDepartment(o))},null,8,["modelValue","optionSelect"])]),t[17]||(t[17]=e("div",{class:"group-input left"},null,-1))]),e("div",F,[e("div",H,[t[18]||(t[18]=e("div",{class:"name"},"Email delivery method",-1)),l(_,{modelValue:a.data.deliver_method_id,"onUpdate:modelValue":t[3]||(t[3]=o=>a.data.deliver_method_id=o),name:"deliver_method_id",placeholder:"กรุณาระบุ",optionSelect:a.optionSelect.deliver_method_id},null,8,["modelValue","optionSelect"])]),e("div",K,[t[19]||(t[19]=e("div",{class:"name"},"SMTP username",-1)),l(m,{modelValue:a.data.smtp_username,"onUpdate:modelValue":t[4]||(t[4]=o=>a.data.smtp_username=o),name:"smtp_username",placeholder:"กรุณาระบุ",type:"text"},null,8,["modelValue"])]),e("div",O,[t[20]||(t[20]=e("div",{class:"name"},"SMTP password",-1)),l(m,{modelValue:a.data.smtp_password,"onUpdate:modelValue":t[5]||(t[5]=o=>a.data.smtp_password=o),name:"smtp_password",placeholder:"กรุณาระบุ",type:"password"},null,8,["modelValue"])])]),e("div",R,[e("div",j,[t[21]||(t[21]=e("div",{class:"name"},"SMTP server",-1)),l(m,{modelValue:a.data.smtp_server,"onUpdate:modelValue":t[6]||(t[6]=o=>a.data.smtp_server=o),name:"smtp_server",placeholder:"กรุณาระบุ",type:"text"},null,8,["modelValue"])]),e("div",z,[t[22]||(t[22]=e("div",{class:"name"},"SMTP port",-1)),l(m,{modelValue:a.data.smtp_port,"onUpdate:modelValue":t[7]||(t[7]=o=>a.data.smtp_port=o),name:"smtp_port",placeholder:"กรุณาระบุ",type:"text"},null,8,["modelValue"])]),e("div",G,[t[23]||(t[23]=e("div",{class:"name"},"SMTP HELLO domain",-1)),l(m,{modelValue:a.data.smtp_hello_domain,"onUpdate:modelValue":t[8]||(t[8]=o=>a.data.smtp_hello_domain=o),name:"smtp_hello_domain",placeholder:"กรุณาระบุ",type:"text"},null,8,["modelValue"])])]),e("div",J,[e("div",Q,[t[24]||(t[24]=e("div",{class:"name"},"SMTP authentication",-1)),l(_,{modelValue:a.data.smtp_authen_id,"onUpdate:modelValue":t[9]||(t[9]=o=>a.data.smtp_authen_id=o),name:"smtp_authen_id",placeholder:"กรุณาระบุ",optionSelect:a.optionSelect.smtp_authen_id},null,8,["modelValue","optionSelect"])]),e("div",W,[l(u,{modelValue:a.data.is_start_tls,"onUpdate:modelValue":t[10]||(t[10]=o=>a.data.is_start_tls=o),name:"is_start_tls"},null,8,["modelValue"]),t[25]||(t[25]=e("div",{class:"name mb-0"},"Automatically use STARTTLS if available",-1))]),e("div",X,[l(u,{modelValue:a.data.is_ssl_connection,"onUpdate:modelValue":t[11]||(t[11]=o=>a.data.is_ssl_connection=o),name:"is_ssl_connection"},null,8,["modelValue"]),t[26]||(t[26]=e("div",{class:"name mb-0"},"Use SSL connection",-1))])])]),t[29]||(t[29]=e("div",{class:"line"},null,-1)),e("div",Y,[e("div",Z,[e("button",{type:"button",class:"button-danger",onClick:t[12]||(t[12]=o=>r.cancelClick())},t[27]||(t[27]=[e("img",{src:L,alt:"times-circle",class:"icon-times-circle"},null,-1),p(" ยกเลิก ")]))]),e("div",$,[e("button",{type:"button",class:"button-primary",onClick:t[13]||(t[13]=o=>r.testmailClick())}," Send a test email "),t[28]||(t[28]=e("button",{type:"submit",class:"button-success"},[e("img",{src:A,alt:"times-circle",class:"icon-check-circle"}),p(" บันทึก ")],-1))])])]),_:1},8,["onSubmit","onInvalidSubmit"])])]),l(g,{modalAlert:a.modalAlert},null,8,["modalAlert"]),l(v,{show:a.showLoading},null,8,["show"])])}const ot=b(M,[["render",tt]]);export{ot as default};

import{_ as U}from"./users-cog-duotone-50670cb2.js";import{_ as A,r as u,o as r,c as p,a as t,e as K,b as i,d as N,F as g,i as y,j as F,h as S,n as h,t as n}from"./index-6f9b4dc9.js";const V="/assets/envelope-solid-83ddb2ac.svg",M="/assets/share-from-square-solid-59b40d2c.svg";const B={name:"mail-manage-inex",data(){return{modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,data:{search:"",table:[],page:1,total:0,lastPage:0,perPage:10,regis_id:"",department_id:"",department_dest_id:""},optionSelect:{regis_id:[],department_id:[],department_dest_id:[]}}},methods:{sendmailClick(l){this.$router.push({name:"automail-sendmail-edit",params:{id:l.id},query:{page:this.data.page,perPage:this.data.perPage}}).catch(()=>{})},listClick(l){this.$router.push({name:"automail-sendmail-list",params:{id:l.book_regis_id},query:{page:this.data.page,perPage:this.data.perPage}}).catch(()=>{})},pageChange(l){this.data.perPage=l.perPage,this.data.page=l.page,this.apiSendmailLists()},search(){this.data.status=!0,this.data.perPage=10,this.data.page=1,this.apiSendmailLists()},apiSendmailLists(){this.data.table=[],this.showLoading=!0,this.axios.get("/book-out-external/book-out-automail",{params:{regis_id:this.data.regis_id,department_id:this.data.department_id,department_dest_id:this.data.department_dest_id,page_size:this.data.perPage,page:this.data.page}}).then(l=>{this.showLoading=!1,l.data.data.meta.filter(e=>{let a=0;e.book_series.filter(m=>{a+=m.subs.length}),a+=e.book_series.length,a+=2,e.rowspan=a}),this.data.table=l.data.data.meta,this.data.total=l.data.data.total,this.data.lastPage=Math.ceil(this.data.total/this.data.perPage)}).catch(l=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:l.response.data.message}})},api_master(){this.showLoading=!0;const l=this.axios.get("/master-data/book-category",{params:{book_type:1}}),e=this.axios.get("/master-data/department-user");this.axios.all([l,e]).then(this.axios.spread((...a)=>{this.showLoading=!1;const m=a[0],s=a[1];m.data.data.filter(d=>(d.value=d.id,d.name=d.name,d)),s.data.data.filter(d=>(d.value=d.id,d.name=d.desc,d.human_flag=d.human_flag,d.response_type=d.type,d)),this.optionSelect.regis_id=m.data.data,this.optionSelect.department_dest_id=s.data.data,this.apiSendmailLists()})).catch(a=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:a.response.data.message}})},keyup_regis_type(l){this.optionSelect.sendTo=[],this.axios.get("/master-data/book-category",{params:{keyword:l.target.value}}).then(e=>{e.data.data&&(e.data.data.filter(a=>(a.value=a.id,a.name=a.name,a)),this.optionSelect.regis_id=e.data.data)})},keyup_department(l){this.optionSelect.sendTo=[],this.axios.get("/master-data/department-user",{params:{keyword:l.target.value}}).then(e=>{e.data.data&&(e.data.data.filter(a=>(a.value=a.id,a.name=a.desc,a.human_flag=a.human_flag,a.response_type=a.type,a)),this.optionSelect.regis_id=e.data.data)})}},mounted(){var l,e;this.data.page=((l=this.$route.query)==null?void 0:l.page)||this.data.page,this.data.perPage=((e=this.$route.query)==null?void 0:e.perPage)||this.data.perPage,this.api_master()}},E={class:"mail-inex"},I={class:"group-overflow"},T={class:"detail"},j={class:"group-detail"},z={class:"group-between"},D={class:"group-input left"},G={class:"group-input"},H={class:"group-between"},J={class:"group-input"},O={class:"group-between"},Q={class:"group-input left"},R={class:"group-input"},W={class:"group-between"},X={class:"group-input left"},Y={class:"group-input"},Z={class:"group-button"},$={class:"button-left"},tt={class:"group-body"},et={class:"table-department-inex"},st={class:"tbody"},at=["rowspan"],ot={class:"col2"},lt={class:"col3"},dt={class:"col4"},nt={class:"col5"},it={class:"col6"},rt={class:"col7"},pt={class:"col8"},ct={class:"col9"},ut={class:"col10"},_t={colspan:"9",class:"col2",style:{"text-align":"left"}},mt={class:"col11"},gt={class:"group-icon"},ht=["onClick"],bt={class:"col3"},vt={class:"col4"},yt={class:"col7"},kt={class:"col8"},ft={class:"col9"},wt={class:"col11"},St={class:"group-icon"},Vt=["onClick"],Pt={key:0,class:"tbody-row"},Ct={class:"group-footer"};function Lt(l,e,a,m,s,d){const b=u("cpn-autoComplete"),k=u("cpn-input"),f=u("cpn-datepicker"),P=u("Form"),C=u("cpn-pagination"),L=u("cpn-modal-alert"),x=u("cpn-loading");return r(),p("div",E,[t("div",I,[t("div",T,[e[26]||(e[26]=K('<div class="group-head"><div class="group-first"><img src="'+U+'" alt="" class="icon-users-cog"><div class="name">รายการหนังสือส่งออก ที่ส่งผ่านอีเมลอัตโนมัติ</div></div></div><div class="line"></div>',2)),i(P,{onSubmit:d.apiSendmailLists,onInvalidSubmit:l.onInvalidSubmit},{default:N(()=>[t("div",j,[t("div",z,[t("div",D,[e[8]||(e[8]=t("div",{class:"name"},"ทะเบียน ",-1)),i(b,{modelValue:s.data.regis_id,"onUpdate:modelValue":e[0]||(e[0]=o=>s.data.regis_id=o),name:"regis_id",onKeyup:d.keyup_regis_type,optionSelect:s.optionSelect.regis_id,placeholder:"กรุณาระบุ"},null,8,["modelValue","onKeyup","optionSelect"])]),t("div",G,[e[9]||(e[9]=t("div",{class:"name"},"เลขออก สลค.",-1)),i(k,{modelValue:s.data.document_number,"onUpdate:modelValue":e[1]||(e[1]=o=>s.data.document_number=o),name:"document_number",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",H,[t("div",J,[e[10]||(e[10]=t("div",{class:"name"},"เรื่อง",-1)),i(k,{modelValue:s.data.name,"onUpdate:modelValue":e[2]||(e[2]=o=>s.data.name=o),name:"name",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",O,[t("div",Q,[e[11]||(e[11]=t("div",{class:"name"},"จาก",-1)),i(b,{modelValue:s.data.department_id,"onUpdate:modelValue":e[3]||(e[3]=o=>s.data.department_id=o),name:"department_id",onKeyup:d.keyup_department,optionSelect:s.optionSelect.department_id,placeholder:"กรุณาระบุ"},null,8,["modelValue","onKeyup","optionSelect"])]),t("div",R,[e[12]||(e[12]=t("div",{class:"name"},"ถึง",-1)),i(b,{modelValue:s.data.department_dest_id,"onUpdate:modelValue":e[4]||(e[4]=o=>s.data.department_dest_id=o),name:"department_dest_id",onKeyup:d.keyup_department,optionSelect:s.optionSelect.department_dest_id,placeholder:"เลือกหน่วยงานปลายทาง"},null,8,["modelValue","onKeyup","optionSelect"])])]),t("div",W,[t("div",X,[e[13]||(e[13]=t("div",{class:"name"},"จากวันที่",-1)),i(f,{modelValue:s.data.start_date,"onUpdate:modelValue":e[5]||(e[5]=o=>s.data.start_date=o),name:"start_date",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",Y,[e[14]||(e[14]=t("div",{class:"name"},"ถึงวันที่",-1)),i(f,{modelValue:s.data.end_date,"onUpdate:modelValue":e[6]||(e[6]=o=>s.data.end_date=o),name:"end_date",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",Z,[t("div",$,[t("button",{type:"button",class:"button-warning",onClick:e[7]||(e[7]=o=>l.cancelClick())},e[15]||(e[15]=[t("i",{class:"bi bi-arrow-clockwise icon-clockwise"},null,-1),S(" ล้างการค้นหา ")]))]),e[16]||(e[16]=t("div",{class:"button-right"},[t("button",{type:"submit",class:"button-search"},[t("i",{class:"bi bi-search icon-search"}),S(" ค้นหา ")])],-1))])])]),_:1},8,["onSubmit","onInvalidSubmit"]),t("div",tt,[t("table",et,[e[25]||(e[25]=t("thead",{class:"thead"},[t("tr",{class:"thead-row"},[t("th",{class:"col1"},"ลำดับ"),t("th",{class:"col2"},"ความเร่งด่วน"),t("th",{class:"col3"},"ชั้นความลับ"),t("th",{class:"col4"},"เลขออก สลค."),t("th",{class:"col5"},"ทะเบียนหนังสือ"),t("th",{class:"col6"},"ชื่อเรื่อง"),t("th",{class:"col7"},"ชนิดหนังสือ"),t("th",{class:"col8"},"ลงวันที่"),t("th",{class:"col9"},"จาก"),t("th",{class:"col10"},"ถึง"),t("th",{class:"col11"},[t("img",{src:V,alt:"",class:"icon-send"})])])],-1)),t("tbody",st,[(r(!0),p(g,null,y(s.data.table,(o,_)=>(r(),p(g,{key:_},[t("tr",{class:h(["tbody-row tbody-row-index",_%2!=0?"color-tr1":"color-tr2"])},[t("td",{class:h(["col1",_%2!=0?"color-tr1":"color-tr2"]),rowspan:o.rowspan},n(_+1+s.data.perPage*(s.data.page-1)),11,at),t("td",ot,n(o.speed_name),1),t("td",lt,n(o.secret_name),1),t("td",dt,n(o.book_out_document_number),1),t("td",nt,n(o.book_regis_name),1),t("td",it,n(o.subject),1),t("td",rt,n(o.book_type_name),1),t("td",pt,n(o.as_of_date),1),t("td",ct,n(o.from),1),t("td",ut,n(o.to),1),e[17]||(e[17]=t("td",{class:"col11"},null,-1))],2),(r(!0),p(g,null,y(o.book_series,(v,q)=>(r(),p(g,{key:q},[t("tr",{class:h(["tbody-row",(_%2==0,"color-tr3")])},[t("td",_t,"ชุดที่ #"+n(v.no),1),t("td",mt,[t("div",gt,[t("img",{onClick:c=>d.listClick(v),src:M,alt:"",class:"icon-send pointer"},null,8,ht)])])],2),(r(!0),p(g,null,y(v.subs,(c,w)=>(r(),p("tr",{class:h(["tbody-row",w%2!=0?"color-tr1":"color-tr2"]),key:w},[e[18]||(e[18]=t("td",{class:"col1"},[t("div")],-1)),e[19]||(e[19]=t("td",{class:"col2"},null,-1)),t("td",bt,n(c.book_out_document_number),1),t("td",vt,n(c.book_regis_name),1),e[20]||(e[20]=t("td",{class:"col5"},null,-1)),e[21]||(e[21]=t("td",{class:"col6"},null,-1)),t("td",yt,n(c.as_of_date),1),t("td",kt,n(c.from),1),t("td",ft,n(c.to),1),t("td",wt,[t("div",St,[t("img",{onClick:xt=>d.sendmailClick(c),src:V,alt:"",class:"icon-send pointer"},null,8,Vt)])])],2))),128)),e[22]||(e[22]=t("tr",{class:"tbody-row-end2"},[t("td",{colspan:"11"})],-1))],64))),128)),t("tr",{class:h(_%2!=0?"tbody-row-end1":"tbody-row-end2")},e[23]||(e[23]=[t("td",{colspan:"11"},null,-1)]),2)],64))),128)),s.data.table.length==0?(r(),p("tr",Pt,e[24]||(e[24]=[t("td",{colspan:"11"},"ไม่มีข้อมูล",-1)]))):F("",!0)])])]),t("div",Ct,[i(C,{page:s.data.page,total:s.data.total,lastPage:s.data.lastPage,perPage:s.data.perPage,onPageChange:d.pageChange},null,8,["page","total","lastPage","perPage","onPageChange"])])])]),i(L,{modalAlert:s.modalAlert},null,8,["modalAlert"]),i(x,{show:s.showLoading},null,8,["show"])])}const At=A(B,[["render",Lt]]);export{At as default};

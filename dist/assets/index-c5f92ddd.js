import{_ as v,r,o as f,c as w,w as c,v as p,a as t,t as x,b as d,d as b,e as N,n as u,f as S,g as y}from"./index-0de73598.js";const I="/assets/pkm_logo-dc0ab453.svg";const R={name:"login-index",data(){return{modalRepass:!1,focusPersonNo:!1,focusPassword:!1,data:{personNo:"",password:"",message:"ชื่อผู้ใช้ หรือ รหัสผ่าน ไม่ถูกต้อง !",fname:"",lname:""},modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,loginFalse:!1}},methods:{closeModalRepass(){this.modalRepass=!1},repasswordClick(){this.modalRepass=!0},onSubmit(l){let s={};s={username:this.data.personNo,password:this.data.password},this.showLoading=!0,this.axios.post("/auth/login",s,{headers:{"Content-Type":"application/json"}}).then(a=>{this.axios.get(`/department/${a.data.data.department_id}`).then(n=>{this.showLoading=!1,n.data.data.filepath?this.axios({method:"get",url:this.backendport+"/"+n.data.data.filepath,baseURL:"",responseType:"blob"}).then(e=>{const i=new Blob([e.data],{type:this.assetsUtils.getTypeFile(n.data.data.filename)});this.setItem({...a,logo_department:URL.createObjectURL(i)})}).catch(e=>{this.setItem({...a,logo_department:""})}):this.setItem({...a,logo_department:""})}).catch(n=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:n.response.data.message}})}).catch(a=>{this.showLoading=!1,this.data.message=a.response.data.message,this.loginFalse=!0,this.data.personNo="",this.data.password=""})},setItem(l){var s,a,n,e,i;localStorage.setItem("logo_department",l.logo_department),localStorage.setItem("user_id",((s=l.data.data)==null?void 0:s.user_id)||""),localStorage.setItem("department_name",((a=l.data.data)==null?void 0:a.department)||""),localStorage.setItem("department_id",((n=l.data.data)==null?void 0:n.department_id)||""),localStorage.setItem("fname",((e=l.data.data)==null?void 0:e.fname)||""),localStorage.setItem("lname",((i=l.data.data)==null?void 0:i.lname)||""),localStorage.setItem("login","true"),this.$router.push({name:"booking-receive"}).catch(()=>{})}},created(){localStorage.setItem("login","false")},watch:{modalRepass(){document.body.style.overflow=this.modalRepass?"hidden":""}}},F={class:"login-index"},k={class:"card-center"},L=t("div",{class:"group-image"},[t("img",{class:"image-logo",src:I,alt:"logo"}),t("div",{class:"title"},"ระบบสารบรรณ Demo")],-1),V={class:"group-input"},C={class:"group-input"},P=t("div",{class:"group-button"},[t("button",{type:"submit",class:"button-login"},"เข้าสู่ระบบ")],-1),U={class:"modal-class-repass"},A={class:"modal-center"},M={class:"modal-size"},B=N('<div class="modal-detail"><div class="image-icon"><img src="'+S+'" alt="" class="image-confirm"></div><div class="title-size">กรุณาติดต่อผู้ดูแลระบบเพื่อทำการเปลี่ยนรหัสผ่าน</div><div class="message">Email : xxxxx123@gmail.com</div><div class="message">โทร : 0xx-xxx-xxxx</div></div>',1),D={class:"group-footer center"},E=t("div",{class:"group-name"},[t("img",{src:y,alt:"",class:"image-times"}),t("div",{class:"name"},"ปิด")],-1),z=[E];function T(l,s,a,n,e,i){const m=r("cpn-input"),g=r("Form"),_=r("cpn-modal-alert"),h=r("cpn-loading");return f(),w("div",F,[c(t("div",{class:"login-false"},x(e.data.message)+" !",513),[[p,e.loginFalse]]),t("div",k,[L,d(g,{onSubmit:s[7]||(s[7]=o=>i.onSubmit(!1)),onInvalidSubmit:l.onInvalidSubmit},{default:b(()=>[t("div",V,[t("div",{class:u(["input-name",!e.data.personNo&&!e.focusPersonNo?"show-text":""])},"ชื่อผู้ใช้งาน หรือ Email",2),d(m,{modelValue:e.data.personNo,"onUpdate:modelValue":s[0]||(s[0]=o=>e.data.personNo=o),name:"personNo",type:"text",classN:"input-login",rules:"required",onFocusin:s[1]||(s[1]=o=>e.focusPersonNo=!0),onFocusout:s[2]||(s[2]=o=>e.focusPersonNo=!1)},null,8,["modelValue"])]),t("div",C,[t("div",{class:u(["input-name",!e.data.password&&!e.focusPassword?"show-text":""])},"รหัสผ่าน",2),d(m,{modelValue:e.data.password,"onUpdate:modelValue":s[3]||(s[3]=o=>e.data.password=o),name:"password",type:"password",classN:"input-login",rules:"required",iconN:"eye",onFocusin:s[4]||(s[4]=o=>e.focusPassword=!0),onFocusout:s[5]||(s[5]=o=>e.focusPassword=!1)},null,8,["modelValue"])]),t("div",{class:"re-password pointer",onClick:s[6]||(s[6]=o=>i.repasswordClick())},"ลืมรหัสผ่าน?"),P]),_:1},8,["onInvalidSubmit"])]),c(t("div",U,[t("div",A,[t("div",M,[B,t("div",D,[t("button",{type:"button",onClick:s[8]||(s[8]=(...o)=>i.closeModalRepass&&i.closeModalRepass(...o)),class:"button-confirm button-success"},z)])])])],512),[[p,e.modalRepass]]),d(_,{modalAlert:e.modalAlert},null,8,["modalAlert"]),d(h,{show:e.showLoading},null,8,["show"])])}const q=v(R,[["render",T]]);export{q as default};

import{_ as b}from"./users-duotone-57e3c13d.js";import{_ as y,a as w}from"./line-up-c54e1bbb.js";import{_ as S}from"./trash-alt-duotone-12d94c28.js";import{_ as k,r as m,o as V,c as z,a as t,t as p,h as r,b as i,d as A,n as x,f as L,k as q}from"./index-6f9b4dc9.js";const C={name:"agency-detail",data(){return{modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,edit:!1,data:{code:"",roman_number:"",department_short_name:"",department_full_name:"",desc:"",organization_id:"",filename:"",filepath:"",active_flag:!0},optionSelect:{organization_id:[]}}},methods:{upload_file(a){document.querySelector(`[name="${a}"]`).click()},file_change(a){for(var e=0;e<document.querySelector(`[name="${a}"]`).files.length;e++){let s=document.querySelector(`[name="${a}"]`).files[e];if(s.type.split("image").length>1){let d={filename:s.name,type:s.type,link:URL.createObjectURL(s),size:(s.size/1024/1024).toFixed(2)+" MB",file:s};this.data={...this.data,...d},document.querySelector(`[name="${a}"]`).value=null}}},back(){this.$router.push({name:"agency",query:{page:this.$route.query.page,perPage:this.$route.query.perPage}}).catch(()=>{})},cancelClick(){this.back(),this.data.code="",this.data.roman_number="",this.data.department_short_name="",this.data.department_full_name="",this.data.desc="",this.data.organization_id="",this.data.filename="",this.data.filepath="",this.data.active_flag=!0},callApiDepartment(){this.axios.get(`/department/${localStorage.getItem("department_id")}`).then(a=>{var e,s;localStorage.setItem("filename",((e=a.data.data)==null?void 0:e.filename)||""),localStorage.setItem("filepath",((s=a.data.data)==null?void 0:s.filepath)||""),this.$emit("getLogoImage",localStorage.getItem("filename"),localStorage.getItem("filepath"))})},onSubmit(){let a=this.assetsUtils.currentDate(),e=this;this.modalAlert={showModal:!0,type:"confirm",title:`คุณยืนยันการ${this.edit?"แก้ไขหน่วยงาน":"สร้างหน่วยงาน"}หรือไม่`,confirm:!0,msgSuccess:!0,afterPressAgree(){if(e.data.file){let s=new FormData;s.append("file",e.data.file),s.append("dst",`${a.split("/")[0]+"-"+a.split("/")[1]+"-"+a.split("/")[2]}`),e.axios.post("/upload/single",s,{headers:{"Content-Type":"multipart/form-data"}}).then(d=>{e.data.filepath=d.data.data.path;let o={code:e.data.code,roman_number:e.data.roman_number,department_full_name:e.data.department_full_name,department_short_name:e.data.department_short_name,organization_id:e.data.organization_id,desc:e.data.desc,filename:e.data.filename,filepath:e.data.filepath,active_flag:e.data.active_flag?1:0};e.showLoading=!0,e.axios[e.edit?"put":"post"](`/department${e.edit?"/"+e.$route.params.id:""}`,o).then(()=>{e.showLoading=!1,e.callApiDepartment(),e.modalAlert={showModal:!0,type:"success",title:e.edit?"ทำการแก้ไขหน่วยงานสำเร็จแล้ว":"ทำการสร้างหน่วยงานสำเร็จแล้ว",msgSuccess:!0,afterPressAgree(){e.back()}}}).catch(n=>{e.showLoading=!1,e.modalAlert={showModal:!0,type:"error",title:"Error",message:n.response.data.message}})}).catch(d=>{e.showLoading=!1,e.modalAlert={showModal:!0,type:"error",title:"Error",message:d.response.data.message}})}else{let s={code:e.data.code,roman_number:e.data.roman_number,department_full_name:e.data.department_full_name,department_short_name:e.data.department_short_name,organization_id:e.data.organization_id,desc:e.data.desc,filename:e.data.filename,filepath:e.data.filepath,active_flag:e.data.active_flag?1:0};e.showLoading=!0,e.axios[e.edit?"put":"post"](`/department${e.edit?"/"+e.$route.params.id:""}`,s).then(()=>{e.showLoading=!1,e.callApiDepartment(),e.modalAlert={showModal:!0,type:"success",title:e.edit?"ทำการแก้ไขหน่วยงานสำเร็จแล้ว":"ทำการสร้างหน่วยงานสำเร็จแล้ว",msgSuccess:!0,afterPressAgree(){e.back()}}}).catch(d=>{e.showLoading=!1,e.modalAlert={showModal:!0,type:"error",title:"Error",message:d.response.data.message}})}}}},api_detail(){this.showLoading=!0,this.axios.get(`/department/${this.$route.params.id}`).then(a=>{this.showLoading=!1,this.optionSelect.organization_id.every(s=>s.id!=a.data.data.organization_id)&&this.optionSelect.organization_id.push({value:a.data.data.organization_id,name:a.data.data.organization_name}),this.data={...this.data,...a.data.data},this.data.active_flag=a.data.data.active_flag==1}).catch(a=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:a.response.data.message}})},api_master(){this.showLoading=!0,this.axios.get("/organization").then(a=>{this.showLoading=!1,a.data.data.filter(e=>(e.value=e.id,e.name=e.name,e)),this.optionSelect.organization_id=a.data.data,this.$route.params.id?(this.edit=!0,this.api_detail()):this.edit=!1}).catch(a=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:a.response.data.message}})},keyup_org(a){this.axios.get("/organization",{params:{keyword:a.target.value}}).then(e=>{e.data.data&&(e.data.data.filter(s=>(s.value=s.id,s.name=s.name,s)),this.optionSelect.organization_id=e.data.data)})}},mounted(){this.api_master()}},M={class:"master-agency-detail"},U={class:"group-overflow"},I={class:"detail"},D={class:"group-head"},E={class:"group-first"},F={class:"name"},P={class:"group-end"},B={class:"group-detail"},N={class:"group-between"},O={class:"group-input left"},K={class:"group-input left"},R={class:"group-input"},T={class:"group-between"},j={class:"group-input left"},G={class:"group-input left"},H={class:"group-input"},J={class:"group-between"},Q={class:"group-input"},W={class:"group-input"},X={class:"d-flex mb-3"},Y={class:"group-input-file"},Z={class:"group-footer"},$={class:"footer-left"},ee={class:"footer-right"},te=["disabled"];function ae(a,e,s,d,o,n){const u=m("cpn-input"),c=m("cpn-toggleSwitch"),_=m("cpn-autoComplete"),g=m("cpn-textArea"),f=m("Form"),h=m("cpn-modal-alert"),v=m("cpn-loading");return V(),z("div",M,[t("div",U,[t("div",I,[t("div",D,[t("div",E,[e[13]||(e[13]=t("img",{src:b,alt:"",class:"icon-users"},null,-1)),t("div",F,p(o.edit?"แก้ไขหน่วยงาน":"สร้างหน่วยงาน"),1)]),t("div",P,[t("button",{type:"button",class:"button-back",onClick:e[0]||(e[0]=l=>n.back())},e[14]||(e[14]=[t("img",{src:y,class:"icon-back"},null,-1),t("img",{src:w,class:"icon-line"},null,-1),r(" ย้อนกลับ ")]))])]),e[27]||(e[27]=t("div",{class:"line"},null,-1)),i(f,{onSubmit:n.onSubmit,onInvalidSubmit:a.onInvalidSubmit},{default:A(()=>[t("div",B,[t("div",N,[t("div",O,[e[15]||(e[15]=t("div",{class:"name"},[r("รหัสหน่วยงาน "),t("span",{class:"required"},"*")],-1)),i(u,{modelValue:o.data.code,"onUpdate:modelValue":e[1]||(e[1]=l=>o.data.code=l),name:"code",rules:"required",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",K,[e[16]||(e[16]=t("div",{class:"name"},"เลขโรมัน",-1)),i(u,{modelValue:o.data.roman_number,"onUpdate:modelValue":e[2]||(e[2]=l=>o.data.roman_number=l),name:"roman_number",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",R,[e[17]||(e[17]=t("div",{class:"name"},"เปิด/ปิด การใช้งาน",-1)),i(c,{modelValue:o.data.active_flag,"onUpdate:modelValue":e[3]||(e[3]=l=>o.data.active_flag=l),name:"active_flag"},null,8,["modelValue"])])]),t("div",T,[t("div",j,[e[18]||(e[18]=t("div",{class:"name"},[r("ชื่อย่อหน่วยงาน "),t("span",{class:"required"},"*")],-1)),i(u,{modelValue:o.data.department_short_name,"onUpdate:modelValue":e[4]||(e[4]=l=>o.data.department_short_name=l),name:"department_short_name",rules:"required",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",G,[e[19]||(e[19]=t("div",{class:"name"},[r("ชื่อหน่วยงาน "),t("span",{class:"required"},"*")],-1)),i(u,{modelValue:o.data.department_full_name,"onUpdate:modelValue":e[5]||(e[5]=l=>o.data.department_full_name=l),name:"department_full_name",rules:"required",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",H,[e[20]||(e[20]=t("div",{class:"name"},[r("กระทรวง "),t("span",{class:"required"},"*")],-1)),i(_,{modelValue:o.data.organization_id,"onUpdate:modelValue":e[6]||(e[6]=l=>o.data.organization_id=l),name:"organization_id",rules:"required",placeholder:"กรุณาระบุ",type:"text",optionSelect:o.optionSelect.organization_id,onKeyup:n.keyup_org},null,8,["modelValue","optionSelect","onKeyup"])])]),t("div",J,[t("div",Q,[e[21]||(e[21]=t("div",{class:"name"},"รายละเอียด",-1)),i(g,{modelValue:o.data.desc,"onUpdate:modelValue":e[7]||(e[7]=l=>o.data.desc=l),name:"desc",rows:"4",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",W,[e[23]||(e[23]=t("div",{class:"name"},[r("รูปหน่วยงาน "),t("span",{class:"required"},"*")],-1)),t("div",X,[t("div",Y,[t("button",{type:"button",class:"button-file",onClick:e[8]||(e[8]=l=>n.upload_file("main_docs"))},[t("span",{class:x(o.data.filename?"":"no-data")},p(o.data.filename?o.data.filename:"รูปหน่วยงาน"),3)]),t("div",{class:"text pointer",onClick:e[9]||(e[9]=l=>n.upload_file("main_docs"))},"แนบไฟล์"),t("input",{type:"file",onChange:e[10]||(e[10]=l=>n.file_change("main_docs")),name:"main_docs",style:{display:"none"},accept:"image/*,"},null,32)]),t("button",{type:"button",class:"del-department",onClick:e[11]||(e[11]=l=>o.data.filename="")},e[22]||(e[22]=[t("img",{src:S,alt:"",class:"image-trash"},null,-1)]))])])]),e[26]||(e[26]=t("div",{class:"line"},null,-1)),t("div",Z,[t("div",$,[t("button",{type:"button",class:"button-danger",onClick:e[12]||(e[12]=l=>n.cancelClick())},e[24]||(e[24]=[t("img",{src:L,alt:"times-circle",class:"icon-times-circle"},null,-1),r(" ยกเลิก ")]))]),t("div",ee,[t("button",{type:"submit",class:"button-success",disabled:!o.data.filename},[e[25]||(e[25]=t("img",{src:q,alt:"times-circle",class:"icon-check-circle"},null,-1)),r(" "+p(o.edit?"ยืนยันแก้ไขหน่วยงาน":"ยืนยันสร้างหน่วยงาน"),1)],8,te)])])]),_:1},8,["onSubmit","onInvalidSubmit"])])]),i(h,{modalAlert:o.modalAlert},null,8,["modalAlert"]),i(v,{show:o.showLoading},null,8,["show"])])}const ne=k(C,[["render",ae]]);export{ne as default};

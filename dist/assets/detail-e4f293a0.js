import{_ as U}from"./users-duotone-57e3c13d.js";import{_ as S,a as k}from"./line-up-c54e1bbb.js";import{_ as z,r as y,o as x,c as L,a as t,t as V,j as c,b as r,d as q,g as I,k as A}from"./index-7bb6a3cd.js";const R={name:"user-manage-detail",data(){return{modalAlert:{showModal:!1,title:"",message:""},showLoading:!1,edit:!1,data:{previewImage1:"",previewImage2:"",profile_img:"",signature_img:"",fname:"",lname:"",username:"",password:"",email:"",department_id:"",organization_id:"",subministry_id:"",group_id:"",level:[],birthdate:"",optionSelect:{organization:[],department:[],subministry:[],group:[],roles:[]},fileType:[]}}},methods:{selectImage(e){this.$refs[e].click()},pickFile(e){for(var a=0;a<this.$refs[e].files.length;a++){let s=this.$refs[e].files[a];if(this.data.fileType.indexOf(s.type)==-1)return this.modalAlert={showModal:!0,type:"error",message:this.defaultMessageErrorFile},!1;(s.type=="image/jpeg"||s.type=="image/png")&&s.size<5e5?(e=="fileInput1"?(this.data.previewImage1=URL.createObjectURL(s),this.data.profile_img=s):(this.data.previewImage2=URL.createObjectURL(s),this.data.signature_img=s),this.$refs[e].value=null):this.modalAlert={showModal:!0,type:"error",title:"Error",message:"*ไฟล์ที่อัพโหลดได้ png, jpg และ jpeg ขนาดไม่เดิน 500 KB"}}},callApiUser(){this.axios.get(`/user/${localStorage.getItem("user_id")}`).then(e=>{var s;localStorage.setItem("profile_img",((s=e.data.data)==null?void 0:s.profile_img)||""),this.$emit("getUserImage",localStorage.getItem("profile_img"),localStorage.getItem("profile_img"));let a={};e.data.data.roles.filter(f=>{a[`user${f.role_id}`]=!0}),this.ruleSet(a)})},keyupOrganization(e){this.data.optionSelect.organization=[],this.axios.get("/master-data/organization",{params:{keyword:e.target.value}}).then(a=>{a.data.data&&(a.data.data.filter(s=>(s.value=s.id,s)),this.data.optionSelect.organization=a.data.data)})},keyupDepartment(e){this.data.optionSelect.department=[],this.axios.get("/master-data/department",{params:{keyword:e.target.value,organization_id:this.data.organization_id,subministry_id:this.data.subministry_id,group_id:this.data.group_id}}).then(a=>{a.data.data&&(a.data.data.filter(s=>(s.value=s.id,s.name=s.department_full_name,s)),this.data.optionSelect.department=a.data.data)})},keyupSubministry(e){this.data.optionSelect.subministry=[],this.axios.get("/master-data/subministry",{params:{keyword:e.target.value,organization_id:this.data.organization_id,department_id:this.data.department_id,group_id:this.data.group_id}}).then(a=>{a.data.data&&(a.data.data.filter(s=>(s.value=s.id,s.name=s.Name,s)),this.data.optionSelect.subministry=a.data.data)})},keyupGroup(e){this.data.optionSelect.group=[],this.axios.get("/master-data/group",{params:{keyword:e.target.value,organization_id:this.data.organization_id,department_id:this.data.department_id,subministry_id:this.data.subministry_id}}).then(a=>{a.data.data&&(a.data.data.filter(s=>(s.value=s.id,s)),this.data.optionSelect.group=a.data.data)})},masterDropdown(e){this.showLoading=!0;const a=this.axios.get(`/master-data/organization?department_id=${this.data.department_id}&subministry_id=${this.data.subministry_id}&group_id=${this.data.group_id}`),s=this.axios.get(`/master-data/department?organization_id=${this.data.organization_id}&subministry_id=${this.data.subministry_id}&group_id=${this.data.group_id}`),f=this.axios.get(`/master-data/subministry?organization_id=${this.data.organization_id}&department_id=${this.data.department_id}&group_id=${this.data.group_id}`),d=this.axios.get(`/master-data/group?organization_id=${this.data.organization_id}&department_id=${this.data.department_id}&subministry_id=${this.data.subministry_id}`);this.axios.all([a,s,f,d]).then(this.axios.spread((...p)=>{var g,i,v,l,w,u,b;this.showLoading=!1;const o=p[0],m=p[1],h=p[2],_=p[3];(g=o.data.data)==null||g.filter(n=>(n.value=n.id,n)),(i=m.data.data)==null||i.filter(n=>(n.value=n.id,n.name=n.department_full_name,n)),(v=h.data.data)==null||v.filter(n=>(n.value=n.id,n)),(l=_.data.data)==null||l.filter(n=>(n.value=n.id,n)),this.data.optionSelect.department=((w=m.data)==null?void 0:w.data)||[],this.data.optionSelect.subministry=((u=h.data)==null?void 0:u.data)||[],this.data.optionSelect.group=((b=_.data)==null?void 0:b.data)||[],m.data.data?m.data.data.findIndex(n=>n.id==this.data.department_id)=="-1"&&(this.data.department_id=""):this.data.department_id="",h.data.data?h.data.data.findIndex(n=>n.id==this.data.subministry_id)=="-1"&&(this.data.subministry_id=""):this.data.subministry_id="",_.data.data?_.data.data.findIndex(n=>n.id==this.data.group_id)=="-1"&&(this.data.group_id=""):this.data.group_id=""})).catch(p=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:p.response.data.message}})},back(){this.$router.push({name:"user-manage",query:{page:this.$route.query.page,perPage:this.$route.query.perPage}}).catch(()=>{})},cancelClick(){this.back(),this.data.previewImage1="",this.data.previewImage2="",this.data.profile_img="",this.data.signature_img="",this.data.username="",this.data.password="",this.data.email="",this.data.organization_id="",this.data.department_id="",this.data.subministry_id="",this.data.group_id="",this.data.level=[],this.data.birthdate="",this.data.fileType=[]},onSubmit(){let e=this;this.modalAlert={showModal:!0,type:"confirm",title:`คุณยืนยันการ${this.edit?"แก้ไขผู้ใช้งาน":"สร้างผู้ใช้งาน"}หรือไม่`,confirm:!0,msgSuccess:!0,afterPressAgree(){var f,d,p,o,m,h,_,g,i,v,l,w;let a=[];e.data.level.filter(u=>{u.flag="delete",a.push(u)}),e.data.optionSelect.roles.filter(u=>{u.flag="add",u.check&&a.push(u)});let s=new FormData;s.append("fname",((f=e.data)==null?void 0:f.fname)||""),s.append("lname",((d=e.data)==null?void 0:d.lname)||""),s.append("email",((p=e.data)==null?void 0:p.email)||""),s.append("department_id",((o=e.data)==null?void 0:o.department_id)||""),s.append("organization_id",((m=e.data)==null?void 0:m.organization_id)||""),s.append("subministry_id",((h=e.data)==null?void 0:h.subministry_id)||""),s.append("group_id",((_=e.data)==null?void 0:_.group_id)||""),s.append("username",((g=e.data)==null?void 0:g.username)||""),s.append("password",((i=e.data)==null?void 0:i.password)||""),s.append("birthdate",((v=e.data)==null?void 0:v.birthdate)||""),s.append("profile_img",((l=e.data)==null?void 0:l.profile_img)||""),s.append("signature_img",((w=e.data)==null?void 0:w.signature_img)||""),s.append("total_role",(a==null?void 0:a.length)||0),a.filter((u,b)=>{u.id&&s.append(`roles[${b}][id]`,u.id),u.role_id&&s.append(`roles[${b}][role_id]`,u.role_id),u.flag&&s.append(`roles[${b}][flag]`,u.flag)}),e.showLoading=!0,e.axios[e.edit?"put":"post"](`/user${e.edit?"/"+e.$route.params.id:""}`,s,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{e.showLoading=!1,e.callApiUser(),e.modalAlert={showModal:!0,type:"success",title:e.edit?"ทำการแก้ไขผู้ใช้งานสำเร็จแล้ว":"ทำการสร้างผู้ใช้งานสำเร็จแล้ว",msgSuccess:!0,afterPressAgree(){e.back()}}}).catch(u=>{e.showLoading=!1,e.modalAlert={showModal:!0,type:"error",title:"Error",message:u.response.data.message}})}}},apiDetail(){this.showLoading=!0,this.axios.get(`/user/${this.$route.params.id}`).then(e=>{this.showLoading=!1,this.data.fname=e.data.data.fname,this.data.lname=e.data.data.lname,this.data.username=e.data.data.username,this.data.password=e.data.data.password,this.data.email=e.data.data.email,this.data.department_id=e.data.data.department_id,this.data.organization_id=e.data.data.organization_id,this.data.subministry_id=e.data.data.subministry_id,this.data.group_id=e.data.data.group_id,this.data.birthdate=e.data.data.birthdate,this.data.level=e.data.data.roles,e.data.data.profile_img?this.axios({method:"get",url:this.backendport+"/"+e.data.data.profile_img,baseURL:"",responseType:"blob"}).then(a=>{const s=new Blob([a.data],{type:this.assetsUtils.getTypeFile(e.data.data.profile_img)});this.data.previewImage1=URL.createObjectURL(s)}).catch(a=>{this.data.previewImage1=new URL("/assets/profile_img-f85ede15.jpg",self.location).href}):this.data.previewImage1=new URL("/assets/profile_img-f85ede15.jpg",self.location).href,e.data.data.signature_img?this.axios({method:"get",url:this.backendport+"/"+e.data.data.signature_img,baseURL:"",responseType:"blob"}).then(a=>{const s=new Blob([a.data],{type:this.assetsUtils.getTypeFile(e.data.data.signature_img)});this.data.previewImage2=URL.createObjectURL(s)}).catch(a=>{this.data.previewImage2=new URL("/assets/signature_img-526e80c1.jpg",self.location).href}):this.data.previewImage2=new URL("/assets/signature_img-526e80c1.jpg",self.location).href,this.data.optionSelect.roles.filter(a=>{a.check=!1,e.data.data.roles.filter(s=>{s.role_id==a.role_id&&(a.check=!0)})})}).catch(e=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:e.response.data.message}})},apiMaster(){this.showLoading=!0;const e=this.axios.get("/master-data/department"),a=this.axios.get("/master-data/role"),s=this.axios.get("/master-data/organization"),f=this.axios.get("/master-data/subministry"),d=this.axios.get("/master-data/group"),p=this.axios.get("/filetype?keyword=&page_size=50&page=1");this.axios.all([e,a,s,f,d,p]).then(this.axios.spread((...o)=>{this.showLoading=!1;const m=o[0],h=o[1],_=o[2],g=o[3],i=o[4],v=o[5];m.data.data.filter(l=>(l.value=l.id,l.name=l.department_full_name,l)),h.data.data.filter(l=>(l.role_id=l.id,l)),_.data.data.filter(l=>(l.value=l.id,l)),g.data.data.filter(l=>(l.value=l.id,l)),i.data.data.filter(l=>(l.value=l.id,l)),this.data.optionSelect.department=m.data.data,this.data.optionSelect.roles=h.data.data,this.data.optionSelect.organization=_.data.data,this.data.optionSelect.subministry=g.data.data,this.data.optionSelect.group=i.data.data,this.data.fileType=[],v.data.data.filter(l=>{l.active_flag==1&&this.data.fileType.push(l.content_type)}),this.$route.params.id?(this.edit=!0,this.apiDetail()):this.edit=!1})).catch(o=>{this.showLoading=!1,this.modalAlert={showModal:!0,type:"error",title:"Error",message:o.response.data.message}})}},mounted(){this.apiMaster()},watch:{"data.organization_id"(){this.masterDropdown()},"data.department_id"(){this.masterDropdown()},"data.subministry_id"(){this.masterDropdown()},"data.group_id"(){this.masterDropdown()}}},T={class:"user-detail"},j={class:"group-overflow"},D={class:"detail"},M={class:"group-head"},F={class:"group-first"},C=t("img",{src:U,alt:"",class:"icon-users"},null,-1),E={class:"name"},B={class:"group-end"},O=t("img",{src:S,class:"icon-back"},null,-1),N=t("img",{src:k,class:"icon-line"},null,-1),P=t("div",{class:"line"},null,-1),G={class:"group-detail"},K={class:"group-between"},H={class:"group-input left"},J=t("div",{class:"name"},"ประเภท",-1),Q={class:"group-input"},W=t("div",{class:"name"},"ทะเบียน",-1),X={class:"group-between"},Y={class:"group-input left"},Z=t("div",{class:"name"},"ชั้นความลับ",-1),$={class:"group-input left"},aa=t("div",{class:"name"},"ความเร่งด่วน",-1),ta={class:"group-input left"},ea=t("div",{class:"name"},"เลขที่ออก สลค.",-1),sa={class:"group-input"},ia=t("div",{class:"name"},"ลงวันที่",-1),da={class:"group-between"},oa={class:"group-input left"},la=t("div",{class:"name"},[c("จากสังกัด/กอง "),t("span",{class:"required"},"*")],-1),na={class:"group-input"},ra=t("div",{class:"name"},[c("ถึง "),t("span",{class:"required"},"*")],-1),ua={class:"group-between"},pa={class:"group-input left"},ma=t("div",{class:"name"},[c("ชื่อเรื่อง "),t("span",{class:"required"},"*")],-1),ha=t("div",{class:"line"},null,-1),_a={class:"group-detail"},ca={class:"group-between"},ga={class:"group-input"},fa=t("div",{class:"name"},[c("คำขึ้นต้น "),t("span",{class:"required"},"*")],-1),va={class:"group-between"},ba={class:"group-input"},wa={class:"group-between"},ya={class:"group-input left"},Va=t("div",{class:"name"},"ข้อความ",-1),Ua={class:"group-between"},Sa={class:"group-input left"},ka=t("div",{class:"name"},"รายละเอียดตามเอกสารที่ส่งมาด้วย",-1),za={class:"group-between"},xa={class:"group-input"},La=t("div",{class:"name"},[c("คำลงท้าย "),t("span",{class:"required"},"*")],-1),qa={class:"group-between"},Ia={class:"group-input"},Aa=t("div",{class:"name"},[c("ชื่อส่วนราชการที่ส่งหนังสือ "),t("span",{class:"required"},"*")],-1),Ra={class:"group-between"},Ta={class:"group-input"},ja=t("div",{class:"name"},[c("ข้อมูลผู้ติดต่อ "),t("span",{class:"required"},"*")],-1),Da={class:"group-between"},Ma={class:"group-input"},Fa=t("div",{class:"line"},null,-1),Ca={class:"group-detail"},Ea={class:"group-between"},Ba={class:"group-input"},Oa=t("div",{class:"name"},[c("ข้อความขอให้ตอบกลับ "),t("span",{class:"required"},"*")],-1),Na={class:"group-between"},Pa={class:"group-input left"},Ga=t("div",{class:"name"},"Disclaimer",-1),Ka=t("div",{class:"line"},null,-1),Ha={class:"group-footer"},Ja={class:"footer-left"},Qa=t("img",{src:I,alt:"times-circle",class:"icon-times-circle"},null,-1),Wa={class:"footer-right"},Xa={type:"submit",class:"button-success"},Ya=t("img",{src:A,alt:"times-circle",class:"icon-check-circle"},null,-1);function Za(e,a,s,f,d,p){const o=y("cpn-input"),m=y("cpn-textArea"),h=y("Form"),_=y("cpn-modal-alert"),g=y("cpn-loading");return x(),L("div",T,[t("div",j,[t("div",D,[t("div",M,[t("div",F,[C,t("div",E,V(d.edit?"แก้ไขผู้ใช้งาน":"สร้างผู้ใช้งาน"),1)]),t("div",B,[t("button",{type:"button",class:"button-back",onClick:a[0]||(a[0]=i=>p.back())},[O,N,c(" ย้อนกลับ ")])])]),P,r(h,{onSubmit:p.onSubmit,onInvalidSubmit:e.onInvalidSubmit},{default:q(()=>[t("div",G,[t("div",K,[t("div",H,[J,r(o,{modelValue:d.data.fname,"onUpdate:modelValue":a[1]||(a[1]=i=>d.data.fname=i),name:"fname",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",Q,[W,r(o,{modelValue:d.data.lname,"onUpdate:modelValue":a[2]||(a[2]=i=>d.data.lname=i),name:"lname",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",X,[t("div",Y,[Z,r(o,{modelValue:d.data.username,"onUpdate:modelValue":a[3]||(a[3]=i=>d.data.username=i),name:"Usern",disabled:d.edit,placeholder:"กรุณาระบุ"},null,8,["modelValue","disabled"])]),t("div",$,[aa,r(o,{modelValue:d.data.password,"onUpdate:modelValue":a[4]||(a[4]=i=>d.data.password=i),name:"passw",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",ta,[ea,r(o,{modelValue:d.data.username,"onUpdate:modelValue":a[5]||(a[5]=i=>d.data.username=i),name:"Usern",disabled:d.edit,placeholder:"กรุณาระบุ"},null,8,["modelValue","disabled"])]),t("div",sa,[ia,r(o,{modelValue:d.data.password,"onUpdate:modelValue":a[6]||(a[6]=i=>d.data.password=i),name:"passw",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",da,[t("div",oa,[la,r(o,{modelValue:d.data.email,"onUpdate:modelValue":a[7]||(a[7]=i=>d.data.email=i),name:"email",placeholder:"กรุณาระบุ"},null,8,["modelValue"])]),t("div",na,[ra,r(o,{modelValue:d.data.email,"onUpdate:modelValue":a[8]||(a[8]=i=>d.data.email=i),name:"email",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",ua,[t("div",pa,[ma,r(o,{modelValue:d.data.email,"onUpdate:modelValue":a[9]||(a[9]=i=>d.data.email=i),name:"email",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])])]),ha,t("div",_a,[t("div",ca,[t("div",ga,[fa,r(o,{modelValue:d.data.fname,"onUpdate:modelValue":a[10]||(a[10]=i=>d.data.fname=i),name:"fname",rule:"required",searchFlag:"true",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",va,[t("div",ba,[r(o,{modelValue:d.data.lname,"onUpdate:modelValue":a[11]||(a[11]=i=>d.data.lname=i),name:"lname",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",wa,[t("div",ya,[Va,r(m,{modelValue:e.input4,"onUpdate:modelValue":a[12]||(a[12]=i=>e.input4=i),name:"input4",rows:"8",placeholder:"Text Area"},null,8,["modelValue"])])]),t("div",Ua,[t("div",Sa,[ka,r(m,{modelValue:e.input4,"onUpdate:modelValue":a[13]||(a[13]=i=>e.input4=i),name:"input4",rows:"2",placeholder:"รายละเอียดตามเอกสารที่ส่งมาด้วย"},null,8,["modelValue"])])]),t("div",za,[t("div",xa,[La,r(o,{modelValue:d.data.fname,"onUpdate:modelValue":a[14]||(a[14]=i=>d.data.fname=i),name:"fname",rule:"required",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",qa,[t("div",Ia,[Aa,r(o,{modelValue:d.data.lname,"onUpdate:modelValue":a[15]||(a[15]=i=>d.data.lname=i),name:"lname",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",Ra,[t("div",Ta,[ja,r(o,{modelValue:d.data.fname,"onUpdate:modelValue":a[16]||(a[16]=i=>d.data.fname=i),name:"fname",rule:"required",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",Da,[t("div",Ma,[r(o,{modelValue:d.data.lname,"onUpdate:modelValue":a[17]||(a[17]=i=>d.data.lname=i),name:"lname",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])])]),Fa,t("div",Ca,[t("div",Ea,[t("div",Ba,[Oa,r(o,{modelValue:d.data.fname,"onUpdate:modelValue":a[18]||(a[18]=i=>d.data.fname=i),name:"fname",rule:"required",searchFlag:"true",placeholder:"กรุณาระบุ"},null,8,["modelValue"])])]),t("div",Na,[t("div",Pa,[Ga,r(m,{modelValue:e.input4,"onUpdate:modelValue":a[19]||(a[19]=i=>e.input4=i),name:"input4",rows:"8",placeholder:"Text Area"},null,8,["modelValue"])])])]),Ka,t("div",Ha,[t("div",Ja,[t("button",{type:"button",class:"button-danger",onClick:a[20]||(a[20]=i=>p.cancelClick())},[Qa,c(" ยกเลิก ")])]),t("div",Wa,[t("button",Xa,[Ya,c(" "+V(d.edit?"ยืนยันแก้ไขผู้ใช้งาน":"ยืนยันสร้างผู้ใช้งาน"),1)])])])]),_:1},8,["onSubmit","onInvalidSubmit"])])]),r(_,{modalAlert:d.modalAlert},null,8,["modalAlert"]),r(g,{show:d.showLoading},null,8,["show"])])}const et=z(R,[["render",Za]]);export{et as default};
